"""K21 配置 — 实体/关系抽取参数

所有路径相对于项目根目录。
"""

from __future__ import annotations

from pathlib import Path

# ---------------------------------------------------------------------------
# 项目根目录（entity_extraction/ 的父目录）
# ---------------------------------------------------------------------------
PROJECT_ROOT = Path(__file__).resolve().parent.parent

# ---------------------------------------------------------------------------
# 结构化数据源路径（规则抽取）
# ---------------------------------------------------------------------------
KNOWLEDGE_BASE_DIR = PROJECT_ROOT / "docs" / "knowledge_base"

HAZARD_SOURCES_PATH = KNOWLEDGE_BASE_DIR / "safety_knowledge" / "hazard_sources.md"
SAFETY_MEASURES_PATH = KNOWLEDGE_BASE_DIR / "safety_knowledge" / "safety_measures.md"
QUALITY_POINTS_PATH = KNOWLEDGE_BASE_DIR / "quality" / "quality_control_points.md"
PROCESS_REFS_DIR = KNOWLEDGE_BASE_DIR / "process_references"

# ---------------------------------------------------------------------------
# 知识片段路径（LLM 抽取）
# ---------------------------------------------------------------------------
FRAGMENTS_PATH = KNOWLEDGE_BASE_DIR / "fragments" / "fragments.jsonl"

# LLM 抽取范围
EXTRACT_CHAPTERS: list[str] = [
    "六、施工方法及工艺要求",
    "七、质量管理与控制措施",
    "八、安全文明施工管理",
]
EXTRACT_DENSITY: list[str] = ["high"]

# ---------------------------------------------------------------------------
# LLM 调用参数（复用项目全局 LLM 配置）
# ---------------------------------------------------------------------------
LLM_MAX_WORKERS: int = 8
LLM_TEMPERATURE: float = 0.1
LLM_MAX_RETRIES: int = 3
LLM_CONTENT_MAX_CHARS: int = 3000  # 片段截断长度

# ---------------------------------------------------------------------------
# 实体标准化参数
# ---------------------------------------------------------------------------
FUZZY_MATCH_THRESHOLD: int = 2  # 编辑距离阈值
MULTI_SOURCE_CONFIDENCE_BOOST: float = 0.1  # 多源确认置信度提升

# ---------------------------------------------------------------------------
# 输出路径
# ---------------------------------------------------------------------------
OUTPUT_DIR = KNOWLEDGE_BASE_DIR / "knowledge_graph"

# ---------------------------------------------------------------------------
# 工程类型缩写映射（用于生成实体 ID）
# ---------------------------------------------------------------------------
ENGINEERING_TYPE_ABBR: dict[str, str] = {
    "变电土建": "civil",
    "变电电气": "elec",
    "线路塔基": "line",
    "特殊作业": "special",
    "地基处理": "found",
    "设备安装": "install",
    "涂装工程": "coat",
    "专题方案": "topic",
    "绿色施工": "green",
    "通用": "common",
}

# ---------------------------------------------------------------------------
# Markdown 章节与工程类型映射（hazard_sources.md 中的章节编号→工程类型）
# ---------------------------------------------------------------------------
HAZARD_SECTION_ENGINEERING_TYPE: dict[str, str] = {
    "2": "变电土建",
    "3": "变电电气",
    "4": "线路塔基",
    "5": "特殊作业",
}

# ---------------------------------------------------------------------------
# 种子词表（用于实体识别锚定和标准化）
# ---------------------------------------------------------------------------
SEED_PROCESSES: list[str] = [
    "钻孔",
    "清孔",
    "浇筑",
    "吊装",
    "焊接",
    "绑扎",
    "养护",
    "振捣",
    "抹灰",
    "涂装",
    "开挖",
    "支护",
    "下放",
    "安装",
    "拆除",
    "检测",
    "回填",
    "夯实",
    "注油",
    "试验",
    "架线",
    "紧线",
]

SEED_EQUIPMENT: list[str] = [
    "钻机",
    "起重机",
    "振动棒",
    "电焊机",
    "搅拌机",
    "泵车",
    "经纬仪",
    "脚手架",
    "模板",
    "串筒",
    "溜槽",
    "振动锤",
    "卷扬机",
    "发电机",
]

SEED_HAZARDS: list[str] = [
    "坍塌",
    "高处坠落",
    "触电",
    "物体打击",
    "机械伤害",
    "中毒窒息",
    "火灾",
    "倾覆",
    "爆炸",
    "烫伤",
    "职业病",
    "淹溺",
]

SEED_SAFETY_MEASURES: list[str] = [
    "安全带",
    "防护栏",
    "安全网",
    "漏电保护器",
    "警戒区",
    "通风检测",
    "安全帽",
    "防护盖板",
    "安全电压",
    "灭火器",
    "防毒面具",
]
