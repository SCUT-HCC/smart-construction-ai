# 审核系统

> 输入一份施工方案，输出检测报告。三个维度：完整性、时效性、合规性。

## 整体流程

```
输入（Markdown/PDF）
  → [如果 PDF] OCR 清洗
  → 章节识别与分割
  → 三维度并行检测
      ├── 章节完整性检查
      ├── 编制依据时效性检查
      └── 内容合规性检查
  → 汇总 → 检测报告
```

## 维度一：章节完整性检查

**目标**：检查方案是否覆盖了 10 大标准章节的核心内容。

### 检测逻辑

```
0. 前置条件：输入必须经过数据管道处理（见 08-data-pipeline），
   LLM 清洗阶段已完成标题层级修复，确保一级标题统一为 ## 格式。
   对于直接输入的 Markdown，如标题格式不符，需先执行标题规范化预处理。
1. 识别文档中的一级标题（##）
2. 将实际标题映射到标准 10 章（允许命名变体）
3. 检查每章的必需子章节是否存在
4. 输出：缺失章节清单 + 完整性评分
```

### 标题映射

文档中的标题命名极不统一（见 02-corpus-analysis），需要**语义映射**而非精确匹配：

| 实际标题 | 映射到标准章节 |
|---------|--------------|
| "编制说明" | 一、编制依据 |
| "工程概述" / "工程简介" | 二、工程概况 |
| "安全管理措施" / "安全文明施工" | 八、安全文明施工管理 |
| "应急处置方案" | 九、应急预案与处置措施 |

实现方式：先规则匹配（关键词），匹配不上的用 LLM 判断。

### 评分规则

| 覆盖情况 | 评分 |
|---------|------|
| 9 章全部覆盖（第十章可选） | ⭐⭐⭐⭐⭐ 优秀 |
| 覆盖 7~8 章 | ⭐⭐⭐⭐ 良好 |
| 覆盖 5~6 章 | ⭐⭐⭐ 合格 |
| 覆盖 <5 章 | ⭐⭐ 不合格 |

每章内部按必需子章节覆盖率加权。

## 维度二：编制依据时效性检查

**目标**：检查方案引用的规范标准是否是现行有效版本。

### 检测逻辑

```
1. 从第一章提取所有引用的标准（正则：GB/T XXXXX-YYYY、DL/T XXXXX-YYYY 等）
2. 查询规范数据库，获取每个标准的最新版本号和状态（现行/废止/替代）
3. 对比引用版本 vs 最新版本
4. 输出：过时依据清单 + 建议更新版本
```

### 规范数据库

需要维护一份**标准版本数据库**：

```json
{
  "GB 50300": {"current": "2013", "status": "现行", "title": "建筑工程施工质量验收统一标准"},
  "DL/T 5210": {"current": "2018", "status": "现行", "title": "电力建设施工质量验收规范"},
  ...
}
```

初始数据从 16 篇文档中提取所有引用标准，手动校验补全。后续可对接国标在线查询 API。

### 输出格式

```
编制依据时效性检测报告
━━━━━━━━━━━━━━━━━━
引用标准总数: 23
过时标准: 3

⚠️ GB 50204-2002 → 已替代为 GB 50204-2015
⚠️ DL/T 5161-2002 → 已替代为 DL/T 5161-2018
⚠️ GB 50666-2011 → 已修订为 GB 50666-2019
```

## 维度三：内容合规性检查

**目标**：检查施工方法、设备配置、人员配备是否符合规范要求。

### 检测逻辑

```
1. 识别文档中的施工方法/工序
2. 通过 LightRAG 推理该工序的强制要求（设备/人员/工艺参数）
3. 检查文档中是否覆盖了这些要求
4. 输出：合规性问题清单 + 规范条款引用
```

### 检查项示例

| 检查项 | 规范依据 | 检测方式 |
|--------|---------|---------|
| 起重吊装是否有专项方案 | GB 50484 | 检查是否有吊装相关章节 |
| 基坑深度>5m 是否有支护方案 | JGJ 120 | 提取深度参数 + 检查支护内容 |
| 特种作业人员是否持证 | 安全生产法 | 检查人员配置章节是否提及持证 |
| 混凝土养护是否有具体措施 | GB 50204 | 检查施工方法章节 |

### 合规性等级

| 等级 | 含义 | 处理 |
|------|------|------|
| 🔴 严重不合规 | 缺少强制要求的内容 | 必须整改 |
| 🟡 部分不合规 | 有内容但不完整 | 建议补充 |
| 🟢 合规 | 满足要求 | — |
| ⚪ 无法判定 | 文档信息不足 | 标记为待人工确认 |

## 检测报告结构

```markdown
# 施工方案检测报告

## 基本信息
- 文档名称: XXX
- 检测时间: YYYY-MM-DD
- 总体评级: ⭐⭐⭐⭐ 良好

## 一、章节完整性
完整性评分: 85/100
缺失章节: 十、绿色施工与环境保护（可选）
薄弱章节: 四、施工安排与进度计划（缺少关键节点）

## 二、编制依据时效性
引用标准: 23 项
过时标准: 3 项（详见清单）

## 三、内容合规性
合规项: 18/22
不合规项: 4 项（详见清单）

## 整改建议
1. [严重] ...
2. [建议] ...
```

## 核心类

| 类 | 职责 |
|---|------|
| `ReviewCoordinator` | 编排三维度检测 |
| `ChapterSplitter` | 章节识别与分割 |
| `ChapterMapper` | 实际标题 → 标准章节映射 |
| `CompletenessChecker` | 完整性检查 |
| `TimelinessChecker` | 时效性检查（依赖规范数据库） |
| `ComplianceChecker` | 合规性检查（依赖 LightRAG） |
| `ReportGenerator` | 生成检测报告 |
