# 全量代码审查

请执行以下步骤：

## 1. 读取代码规范

先读取 `.claude/code-style-guide.md`，理解所有审查标准。

## 2. 扫描整个项目

遍历 `herald/` 目录下所有 `.py` 文件（跳过 `__pycache__`），逐文件审查。

## 3. 审查维度

对每个文件，检查以下维度：
- **模块职责**：是否只做一件事？行数是否超 300？模块 docstring 是否缺失/不清晰？
- **类设计**：纯数据是否用 dataclass？配置是否用 Pydantic？继承是否超过一层？
- **函数设计**：是否有超过 60 行的函数？参数是否超过 5 个？是否有默认值掩盖关键参数？
- **类型注解**：函数签名是否完整？是否有 `Any` 滥用？
- **错误处理**：是否有裸 `except:`？Tool 是否优雅降级？
- **命名**：是否符合命名约定？
- **日志**：是否使用 loguru？有没有 print()？
- **反模式**：对照反模式清单逐项检查
- **与 CLAUDE.md 的一致性**：是否违反 CLAUDE.md 中的规则？

## 4. 输出 implementation_plan.md

将审查结果写入项目根目录的 `implementation_plan.md`，格式如下：

```markdown
# 代码审查报告 — Herald

> 审查时间: YYYY-MM-DD HH:MM
> 审查范围: 全量（herald/ 所有 .py 文件）
> 审查标准: .claude/code-style-guide.md + CLAUDE.md

## 摘要

- 审查文件数: X
- 发现问题数: Y（严重 A / 一般 B / 建议 C）
- 总体评价: （一两句话）

## 审查点 (Review Points)

### [严重] 文件路径 — 问题标题

**问题描述**: ...
**代码位置**: 行 XX-YY
**当前代码**:
\`\`\`python
# 有问题的代码片段（关键部分，不超过 10 行）
\`\`\`
**建议修改**:
\`\`\`python
# 建议的改法
\`\`\`
**理由**: ...

---

### [一般] ...

---

## 验证计划

修改完成后的验证步骤：
1. ...
2. ...
```

## 5. 重要提醒

- **不要直接修改任何代码**，只输出 implementation_plan.md
- 问题严重程度：[严重] 影响正确性/安全性 | [一般] 影响可维护性/可读性 | [建议] 优化建议
- 如果没有发现问题，在摘要中说明代码质量良好
- 覆盖已有的 implementation_plan.md
