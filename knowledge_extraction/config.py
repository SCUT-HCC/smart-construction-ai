"""知识提取配置 — 映射规则、文档评级、LLM 参数等集中管理。"""

from typing import Dict, List

# ── 文档处理范围 ──────────────────────────────────────────────
DOCS_TO_PROCESS: List[int] = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 15, 16]

# ── 文档质量评级（来自 02-corpus-analysis.md）──────────────────
# 3=高质量, 2=中质量, 1=低质量
DOC_QUALITY: Dict[int, int] = {
    1: 2, 2: 2, 3: 1, 4: 3, 5: 2, 6: 3,
    7: 3, 8: 2, 9: 2, 10: 3, 11: 3, 12: 3,
    15: 2, 16: 2,
}

# ── 文档级默认工程类型（来自 02-corpus-analysis.md）─────────────
DOC_ENGINEERING_TYPE: Dict[int, str] = {
    1: "线路塔基",
    2: "涂装工程",
    3: "涂装工程",
    4: "变电土建",
    5: "绿色施工",
    6: "变电土建",
    7: "变电电气",
    8: "专题方案",
    9: "变电土建",
    10: "设备安装",
    11: "地基处理",
    12: "线路塔基",
    15: "线路塔基",
    16: "专题方案",
}

# ── 标准 10 章结构定义 ────────────────────────────────────────
STANDARD_CHAPTERS: Dict[str, str] = {
    "Ch1": "一、编制依据",
    "Ch2": "二、工程概况",
    "Ch3": "三、施工组织机构及职责",
    "Ch4": "四、施工安排与进度计划",
    "Ch5": "五、施工准备",
    "Ch6": "六、施工方法及工艺要求",
    "Ch7": "七、质量管理与控制措施",
    "Ch8": "八、安全文明施工管理",
    "Ch9": "九、应急预案与处置措施",
    "Ch10": "十、绿色施工与环境保护",
}

# ── 章节映射规则（精确关键词 + 变体关键词）─────────────────────
# 每个 key 为标准章节 ID，value 为两个列表：[精确关键词, 变体关键词]
# 匹配优先级：精确 > 变体。匹配逻辑为"标题包含该关键词"。
CHAPTER_MAPPING: Dict[str, Dict[str, List[str]]] = {
    "Ch1": {
        "exact": ["编制依据"],
        "variant": ["编制说明", "编制目的", "编写依据"],
    },
    "Ch2": {
        "exact": ["工程概况"],
        "variant": ["工程概述", "工程简介", "项目概况", "工程地质"],
    },
    "Ch3": {
        "exact": ["施工组织机构", "组织机构"],
        "variant": ["项目组织", "管理组织", "岗位职责", "管理人员", "管理机构"],
    },
    "Ch4": {
        "exact": ["施工安排", "进度计划"],
        "variant": ["施工计划", "施工工期", "工期规划", "施工组织及"],
    },
    "Ch5": {
        "exact": ["施工准备"],
        "variant": ["准备工作", "资源配置", "劳动力", "设备计划", "材料供应"],
    },
    "Ch6": {
        "exact": ["施工方法", "施工工艺", "工艺要求"],
        "variant": [
            "施工技术", "施工措施", "主要工序", "施工方案概述",
            "施工工艺技术", "施工技术措施", "基础施工", "安装施工",
        ],
    },
    "Ch7": {
        "exact": ["质量管理", "质量控制"],
        "variant": ["质量工艺", "质量保证", "质量检验", "质量通病", "成品保护"],
    },
    "Ch8": {
        "exact": ["安全管理", "安全措施", "安全技术"],
        "variant": [
            "安全文明", "文明施工", "危险源", "安健环", "安全风险",
            "安全组织", "现场安全", "临时用电", "安全用电",
        ],
    },
    "Ch9": {
        "exact": ["应急预案", "应急处置"],
        "variant": ["应急措施", "应急响应"],
    },
    "Ch10": {
        "exact": ["绿色施工", "环境保护"],
        "variant": ["环保措施", "水土保护", "季节性施工", "环境因素"],
    },
}

# ── 行政内容过滤关键词 ────────────────────────────────────────
ADMIN_KEYWORDS: List[str] = [
    "报审", "报验", "盖章", "一式", "附件：", "附件:",
    "(签字)", "（签字）", "执业印章",
]

ADMIN_TITLE_KEYWORDS: List[str] = [
    "目录", "报审表", "报验表",
]

# ── 签字栏/封面检测模式 ──────────────────────────────────────
COVER_PATTERNS: List[str] = [
    "编写:", "编写：", "审核:", "审核：", "批准:", "批准：",
    "编制:", "编制：", "日期:", "日期：",
    "致：", "致:", "本表（含附件）", "本表(含附件)",
]

# ── 子章节级工程类型覆盖关键词 ────────────────────────────────
ENGINEERING_TYPE_KEYWORDS: Dict[str, List[str]] = {
    "变电电气": ["主变", "GIS", "开关柜", "电缆", "接地装置", "避雷", "绝缘", "油务", "真空断路器"],
    "变电土建": ["钢筋", "混凝土", "模板", "砌体", "基坑", "回填", "抹灰", "屋面", "防水"],
    "线路塔基": ["灌注桩", "挖孔桩", "钻孔", "护筒", "钢筋笼", "铁塔", "杆塔", "线路"],
    "设备安装": ["起重", "吊装", "钢丝绳", "卸扣", "配重", "就位", "吊车"],
    "涂装工程": ["喷涂", "防腐", "防火涂料", "底漆", "面漆", "锌", "油漆"],
    "地基处理": ["强夯", "地基", "夯击", "填土", "承载力"],
}

# ── 领域关键词表（用于 tags 提取）────────────────────────────
DOMAIN_KEYWORDS: List[str] = [
    # 土建类
    "混凝土", "钢筋", "模板", "浇筑", "振捣", "养护", "拆模", "基坑",
    "回填", "砌体", "抹灰", "防水", "屋面", "装饰",
    # 电气类
    "主变", "GIS", "开关柜", "电缆", "接地", "调试", "绝缘", "油务",
    "避雷器", "互感器", "真空断路器",
    # 基础类
    "灌注桩", "挖孔桩", "钻孔", "护筒", "清孔", "钢筋笼", "桩基",
    # 安装类
    "起重", "吊装", "钢丝绳", "卸扣", "吊车", "就位",
    # 安全类
    "危险源", "安全带", "防护栏", "安全网", "监护", "临时用电",
    "高处作业", "有限空间", "交叉作业",
    # 质量类
    "验收", "检验", "合格率", "偏差", "保护层", "垂直度",
    # 工艺类
    "强夯", "夯击", "喷涂", "防腐", "防火涂料",
    # 应急类
    "触电", "坍塌", "高处坠落", "物体打击", "火灾", "中毒",
    # 绿色施工
    "节水", "节材", "节地", "扬尘", "噪音", "废弃物",
]

# ── 提取优先级 ────────────────────────────────────────────────
CHAPTER_PRIORITY: Dict[str, str] = {
    "Ch1": "P0", "Ch6": "P0",
    "Ch7": "P1", "Ch8": "P1",
    "Ch3": "P2", "Ch9": "P2",
    "Ch2": "P3", "Ch4": "P3", "Ch5": "P3", "Ch10": "P3",
}

# ── LLM 并发数 ────────────────────────────────────────────────
# 密度评估和内容改写的线程池大小，根据 API 限流调整
LLM_MAX_WORKERS: int = 8

# ── 去重阈值 ──────────────────────────────────────────────────
DEDUP_THRESHOLD: float = 0.8

# ── ContentRefiner 改写后最短字数（低于则降级为 low）───────────
REFINE_MIN_CHARS: int = 30

# ── 输出路径 ──────────────────────────────────────────────────
OUTPUT_DIR: str = "docs/knowledge_base/fragments"
FRAGMENTS_FILE: str = "fragments.jsonl"
REPORT_FILE: str = "extraction_report.md"

# ── 输入路径模板 ──────────────────────────────────────────────
INPUT_PATH_TEMPLATE: str = "output/{doc_id}/final.md"
